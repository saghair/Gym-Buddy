<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gym Buddy â€“ Login</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
<header>
  <div class="navbar">
    <a href="index.html" class="brand">
      <div class="brand-pill">GB</div>
      <span>Gym Buddy</span>
    </a>
    <nav>
      <ul>
        <li><a href="login.html" class="active">Login</a></li>
      </ul>
    </nav>
  </div>
</header>

<main>
  <h1 class="page-title">Welcome to Gym Buddy</h1>
  <p class="page-subtitle">
    Log in or create an account to track your workouts and see your progress.
  </p>

  <section class="card">
    <div class="card-header">
      <h2 class="card-title">Sign in / Sign up</h2>
      <span class="badge">Supabase Auth</span>
    </div>
    <div class="card-body">
      <div class="form-row">
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" />
        </div>
        <div class="field">
          <label for="password">Password</label>
          <input id="password" type="password" />
        </div>
      </div>
      <div class="btn-row">
        <button id="btn-login" class="btn btn-primary">Log in</button>
        <button id="btn-signup" class="btn btn-outline">Sign up</button>
      </div>
      <div id="auth-status" class="status-text"></div>
    </div>
  </section>
</main>

<script type="module">
  import { supabase, getCurrentUser } from "./assets/js/supabaseClient.js";

  const email = document.getElementById("email");
  const password = document.getElementById("password");
  const status = document.getElementById("auth-status");
  const btnLogin = document.getElementById("btn-login");
  const btnSignup = document.getElementById("btn-signup");

  // If already logged in, go to dashboard
  (async () => {
    const user = await getCurrentUser();
    if (user) {
      window.location.href = "index.html";
    }
  })();

  btnSignup.addEventListener("click", async () => {
    status.textContent = "Creating your account...";
    const { error } = await supabase.auth.signUp({
      email: email.value,
      password: password.value
    });
    status.textContent = error
      ? error.message
      : "Check your email inbox to confirm your account.";
  });

  btnLogin.addEventListener("click", async () => {
    status.textContent = "Signing in...";
    const { error } = await supabase.auth.signInWithPassword({
      email: email.value,
      password: password.value
    });

    if (error) {
      status.textContent = error.message;
    } else {
      status.textContent = "Logged in!";
      window.location.href = "index.html";
    }
  });
</script>
</body>
</html>
